<select name="{{ field.path }}" id="{{ field.id }}"{{ field.render_attrs }}>
    {% for choice in field.choice_to_options_selected %}
        <option value="{{ choice.1 }}" {% if choice.3 %}selected="selected"{% endif %} label="{{ choice.2 }}">{{ choice.2 }}</option>
    {% endfor %}
</select>

<style>
    #{{ field.id }} {
        min-width: 200px;
    }
</style>

<script type="text/javascript">
    var id_field = "#{{ field.id }}";
    $(id_field).select2({
        placeholder: '', // TODO: would be nice to configure this
        ajax: {
            url: ".",
            dataType: "json",
            data: function (params) {
                return {
                    '{{ field.endpoint_path }}': params.term, // search term
                    page: params.page
                };
            }
        },
        allowClear: true,
        multiple: {% if field.attrs.multiple %}true{% else %}false{% endif %},
        minimumInputLength: 2
    });


    {% if field.value %}
        $(id_field).select2("val", "{{ field.value }}", true);
    {% endif %}
</script>
